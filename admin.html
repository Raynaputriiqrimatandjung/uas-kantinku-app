<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Kantinku</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root { --primary: #ff7f50; --bg: #f4f6f8; }
        body { font-family: 'Poppins', sans-serif; background: var(--bg); margin: 0; padding: 20px; }
        
        .admin-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .btn-create { background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 8px; }
        .btn-create:hover { background: #e6602e; }

        /* TABLE STYLE */
        .table-container { background: white; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); overflow: hidden; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 15px 20px; text-align: left; border-bottom: 1px solid #eee; }
        th { background: #f9f9f9; font-weight: 600; color: #555; }
        tr:hover { background: #fafafa; }
        
        .status-badge { padding: 5px 10px; border-radius: 20px; font-size: 0.8rem; font-weight: bold; }
        .status-available { background: #d4edda; color: #155724; }
        .status-habis { background: #f8d7da; color: #721c24; }

        .actions button { margin-right: 5px; padding: 6px 10px; border: none; border-radius: 5px; cursor: pointer; color: white; }
        .btn-edit { background: #f39c12; }
        .btn-delete { background: #e74c3c; }

        /* MODAL POPUP */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; z-index: 1000; }
        .modal.active { display: flex; }
        .modal-content { background: white; padding: 30px; border-radius: 12px; width: 100%; max-width: 450px; position: relative; }
        
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: 500; font-size: 0.9rem; }
        .form-control { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        .btn-save { width: 100%; padding: 12px; background: var(--primary); color: white; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        
        .close-modal { position: absolute; top: 15px; right: 20px; cursor: pointer; font-size: 1.2rem; color: #999; }
    </style>
</head>
<body>

    <div class="admin-header">
        <h2>üçΩÔ∏è Dapur & Menu Manager</h2>
        <div style="display:flex; gap:10px;">
            <a href="menu.html" style="text-decoration:none; display:flex; align-items:center; color:#555; font-weight:600; background:white; padding:8px 15px; border-radius:8px;">
                <i class="fas fa-eye" style="margin-right:5px;"></i> Lihat Web
            </a>
            <button class="btn-create" onclick="openModal()">
                <i class="fas fa-plus"></i> Tambah Menu
            </button>
        </div>
    </div>

    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>Gambar</th>
                    <th>Nama Menu</th>
                    <th>Kategori</th>
                    <th>Harga</th>
                    <th>Status</th>
                    <th>Aksi</th>
                </tr>
            </thead>
            <tbody id="menuTableBody">
                </tbody>
        </table>
    </div>

    <div class="modal" id="modalForm">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            <h3 id="modalTitle">Tambah Menu Baru</h3>
            <form id="menuForm" onsubmit="handleSave(event)">
                <input type="hidden" id="menuId">
                
                <div class="form-group">
                    <label>Nama Makanan</label>
                    <input type="text" id="nama" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label>Kategori</label>
                    <select id="kategori" class="form-control">
                        <option value="makanan">Makanan Berat</option>
                        <option value="minuman">Minuman</option>
                        <option value="snack">Snack</option>
                        <option value="sarapan">Sarapan</option>
                        <option value="promo">Promo</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Harga (Rp)</label>
                    <input type="number" id="harga" class="form-control" required>
                </div>

                <div class="form-group">
                    <label>Status</label>
                    <select id="status" class="form-control">
                        <option value="tersedia">Tersedia</option>
                        <option value="habis">Habis (Sold Out)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>URL Gambar</label>
                    <input type="text" id="gambar" class="form-control" placeholder="https://..." required>
                </div>

                <div class="form-group">
                    <label>Deskripsi</label>
                    <textarea id="deskripsi" class="form-control" rows="2"></textarea>
                </div>

                <button type="submit" class="btn-save" id="btnSave">Simpan Data</button>
            </form>
        </div>
    </div>

    <script>
        // ‚ö†Ô∏è‚ö†Ô∏è SAMAKAN LINK INI DENGAN FILE MENU.HTML ‚ö†Ô∏è‚ö†Ô∏è
        const API_URL = "https://uas-menu-service.vercel.app"; 

        let allMenus = [];

        // LOAD DATA (READ)
        document.addEventListener('DOMContentLoaded', fetchMenus);

        async function fetchMenus() {
            try {
                const res = await fetch(`${API_URL}/menu`);
                const data = await res.json();
                allMenus = data;
                renderTable(data);
            } catch (err) {
                alert("Gagal ambil data. Cek API URL.");
            }
        }

        function renderTable(data) {
            const tbody = document.getElementById('menuTableBody');
            tbody.innerHTML = '';
            
            data.forEach(item => {
                const isHabis = item.status === 'habis';
                tbody.innerHTML += `
                    <tr>
                        <td><img src="${item.gambar}" width="50" style="border-radius:5px;"></td>
                        <td>${item.nama}</td>
                        <td style="text-transform:capitalize;">${item.kategori}</td>
                        <td>Rp ${item.harga}</td>
                        <td>
                            <span class="status-badge ${isHabis ? 'status-habis' : 'status-available'}">
                                ${isHabis ? 'Habis' : 'Tersedia'}
                            </span>
                        </td>
                        <td class="actions">
                            <button class="btn-edit" onclick='openEdit("${item._id}")'><i class="fas fa-edit"></i></button>
                            <button class="btn-delete" onclick='deleteMenu("${item._id}")'><i class="fas fa-trash"></i></button>
                        </td>
                    </tr>
                `;
            });
        }

        // OPEN MODAL (CREATE vs EDIT Logic)
        function openModal() {
            document.getElementById('modalForm').classList.add('active');
            document.getElementById('menuForm').reset();
            document.getElementById('menuId').value = ''; 
            document.getElementById('modalTitle').innerText = "Tambah Menu Baru";
        }

        function openEdit(id) {
            const item = allMenus.find(m => m._id === id);
            if(item) {
                document.getElementById('modalForm').classList.add('active');
                document.getElementById('modalTitle').innerText = "Edit Menu";
                
                // Isi Form
                document.getElementById('menuId').value = item._id;
                document.getElementById('nama').value = item.nama;
                document.getElementById('harga').value = item.harga;
                document.getElementById('kategori').value = item.kategori;
                document.getElementById('gambar').value = item.gambar;
                document.getElementById('status').value = item.status || 'tersedia';
                document.getElementById('deskripsi').value = item.deskripsi || '';
            }
        }

        function closeModal() {
            document.getElementById('modalForm').classList.remove('active');
        }

        // CREATE & UPDATE LOGIC
        async function handleSave(e) {
            e.preventDefault();
            const id = document.getElementById('menuId').value;
            const btn = document.getElementById('btnSave');
            
            const payload = {
                nama: document.getElementById('nama').value,
                harga: Number(document.getElementById('harga').value),
                kategori: document.getElementById('kategori').value,
                gambar: document.getElementById('gambar').value,
                status: document.getElementById('status').value,
                deskripsi: document.getElementById('deskripsi').value
            };

            btn.innerText = "Menyimpan...";
            btn.disabled = true;

            try {
                let url = `${API_URL}/menu`;
                let method = 'POST';

                if(id) { // Jika ada ID, berarti mode EDIT (PUT)
                    url = `${API_URL}/menu/${id}`;
                    method = 'PUT';
                }

                const res = await fetch(url, {
                    method: method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if(res.ok) {
                    closeModal();
                    fetchMenus(); // Refresh tabel
                } else {
                    alert("Gagal menyimpan data.");
                }

            } catch (err) {
                console.error(err);
                alert("Error koneksi.");
            } finally {
                btn.innerText = "Simpan Data";
                btn.disabled = false;
            }
        }

        // DELETE LOGIC
        async function deleteMenu(id) {
            if(confirm("Yakin ingin menghapus menu ini?")) {
                try {
                    await fetch(`${API_URL}/menu/${id}`, { method: 'DELETE' });
                    fetchMenus(); // Refresh tabel
                } catch (err) {
                    alert("Gagal menghapus.");
                }
            }
        }
    </script>
</body>
</html>