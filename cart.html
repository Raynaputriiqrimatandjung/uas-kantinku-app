<!DOCTYPE html>
<html lang="id">
<head>
    <title>Keranjang - Kantinku</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <nav class="navbar">
        <a href="menu.html" class="brand"><i class="fas fa-arrow-left"></i> Kembali ke Menu</a>
    </nav>

    <div class="container" style="padding: 2rem 5%;">
        <h2>ðŸ›’ Keranjang Pesanan</h2>
        
        <div style="display: flex; flex-wrap: wrap; gap: 30px; margin-top: 20px;">
            <div style="flex: 2; min-width: 300px;">
                <div id="cartItems" style="background: white; border-radius: 12px; box-shadow: var(--shadow); overflow: hidden;">
                    <div style="padding: 2rem; text-align: center; color: #888;">
                        Keranjang masih kosong.
                    </div>
                </div>
            </div>

            <div style="flex: 1; min-width: 250px;">
                <div class="card" style="position: sticky; top: 100px;">
                    <div class="card-body">
                        <h3>Ringkasan</h3>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span>Total Item</span>
                            <span id="totalQty">0</span>
                        </div>
                        <hr style="border: 0; border-top: 1px solid #eee;">
                        <div style="display: flex; justify-content: space-between; margin: 15px 0; font-size: 1.2rem; font-weight: bold;">
                            <span>Total Harga</span>
                            <span id="totalPrice" style="color: var(--primary);">Rp 0</span>
                        </div>
                        <button onclick="checkout()" id="btnCheckout" class="btn btn-primary" style="width: 100%;" disabled>
                            Checkout Sekarang
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="utils.js"></script>
    <script>
        let cart = JSON.parse(localStorage.getItem('kantinku_cart')) || [];
        renderCart();

        function renderCart() {
            const container = document.getElementById('cartItems');
            const btnCheckout = document.getElementById('btnCheckout');
            
            if (cart.length === 0) {
                container.innerHTML = '<div style="padding: 2rem; text-align: center; color: #888;">Keranjang masih kosong. <br><a href="menu.html" style="color:var(--primary)">Pesan dulu yuk!</a></div>';
                document.getElementById('totalQty').innerText = 0;
                document.getElementById('totalPrice').innerText = formatRupiah(0);
                btnCheckout.disabled = true;
                return;
            }

            btnCheckout.disabled = false;
            let html = '<table style="width:100%; border-collapse: collapse;">';
            let total = 0;
            let qty = 0;

            cart.forEach((item, index) => {
                const subtotal = item.harga * item.qty;
                total += subtotal;
                qty += item.qty;

                html += `
                    <tr style="border-bottom: 1px solid #eee;">
                        <td style="padding: 15px; width: 80px;">
                            <img src="${item.gambar || 'https://placehold.co/50'}" style="width: 60px; height: 60px; border-radius: 8px; object-fit: cover;">
                        </td>
                        <td style="padding: 15px;">
                            <div style="font-weight: bold;">${item.nama}</div>
                            <div style="color: #888; font-size: 0.9rem;">${formatRupiah(item.harga)}</div>
                        </td>
                        <td style="padding: 15px; text-align: right;">
                            <div style="display: flex; align-items: center; justify-content: flex-end; gap: 10px;">
                                <button onclick="updateQty(${index}, -1)" class="btn btn-outline" style="padding: 5px 10px; font-size: 0.8rem;">-</button>
                                <span style="font-weight: bold; width: 20px; text-align: center;">${item.qty}</span>
                                <button onclick="updateQty(${index}, 1)" class="btn btn-outline" style="padding: 5px 10px; font-size: 0.8rem;">+</button>
                            </div>
                        </td>
                        <td style="padding: 15px; text-align: right; font-weight: bold; color: var(--primary);">
                            ${formatRupiah(subtotal)}
                        </td>
                        <td style="padding: 15px;">
                            <button onclick="removeItem(${index})" class="btn" style="color: #ff4757;"><i class="fas fa-trash"></i></button>
                        </td>
                    </tr>
                `;
            });

            html += '</table>';
            container.innerHTML = html;
            document.getElementById('totalQty').innerText = qty;
            document.getElementById('totalPrice').innerText = formatRupiah(total);
        }

        function updateQty(index, change) {
            if (cart[index].qty + change > 0) {
                cart[index].qty += change;
            }
            saveAndRender();
        }

        function removeItem(index) {
            if(confirm("Hapus menu ini dari keranjang?")) {
                cart.splice(index, 1);
                saveAndRender();
            }
        }

        function saveAndRender() {
            localStorage.setItem('kantinku_cart', JSON.stringify(cart));
            renderCart();
            // Update badge di navbar jika ada (perlu reload atau event listener, tapi cukup renderCart di page ini)
        }

        function checkout() {
            // Simulasi Checkout Sederhana
            if(confirm(`Total pembayaran ${document.getElementById('totalPrice').innerText}. Lanjutkan pembayaran?`)) {
                // Disini nanti bisa integrasi ke Backend Order (Tugas Lanjutan)
                // Untuk sekarang, kita simulasi sukses dan kosongkan keranjang
                
                showToast("Pesanan Berhasil dibuat!", "success");
                
                // Kosongkan Keranjang
                localStorage.removeItem('kantinku_cart');
                cart = [];
                renderCart();

                setTimeout(() => {
                    alert("Terima kasih! Pesanan Anda sedang disiapkan dapur.");
                    window.location.href = 'menu.html';
                }, 1500);
            }
        }
    </script>
</body>
</html>